{% include social-buttons.html %}


<div id="desktopvisible" class="card" style="width: 100%;">

   
  {% if page.gallery %}
     
      <div id="carouselExampleIndicators2" class="carousel slide">
           <h4>Gallery</h4>
        <div class="carousel-indicators2">
          {% for image in page.gallery %}
            <button type="button" data-bs-target="#carouselExampleIndicators2" data-bs-slide-to="{{ forloop.index0 }}" {% if forloop.first %}class="active"{% endif %} aria-label="Slide {{ forloop.index }}">
            </button>
          {% endfor %}
        </div>
        <div class="carousel-inner">
          {% for image in page.gallery %}
            <div class="carousel-item {% if forloop.first %}active{% endif %}">
              <img src="{{ image }}" class="d-block w-100" alt="...">
            </div>
          {% endfor %}
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators2" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators2" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>
    {% endif %}  
    
    
    {% if page.photos %}
    
      <div id="carouselExampleIndicators3" class="carousel slide">
          <h4>Photos</h4>
        <div class="carousel-indicators3">
          {% for image in page.photos %}
            <button type="button" data-bs-target="#carouselExampleIndicators3" data-bs-slide-to="{{ forloop.index0 }}" {% if forloop.first %}class="active"{% endif %} aria-label="Slide {{ forloop.index }}">
            </button>
          {% endfor %}
        </div>
        <div class="carousel-inner">
          {% for image in page.photos %}
            <div class="carousel-item {% if forloop.first %}active{% endif %}">
              <img src="{{ image }}" class="d-block w-100" alt="...">
            </div>
          {% endfor %}
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators3" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators3" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>
    {% endif %}  
    
    
       
</div>




<script>
    document.addEventListener('DOMContentLoaded', function () {
      var sidebar = document.getElementById('sidebar-plus');
      var totalPosts = document.createElement('p');

      totalPosts.textContent = 'Total posts: ' + {{ site.community | size }};
      sidebar.appendChild(totalPosts);
    });
  </script>
    
    
    <b><div id="sidebar-plus"></div></b>


<div id="blog-archive">
    <h4>Community posts</h4>
    <select id="archive-year"></select>
    <select id="archive-month"></select>
    <div id="archive-posts"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () { 
    var archiveYearSelect = document.getElementById('archive-year');
    var archiveMonthSelect = document.getElementById('archive-month');
    var archivePostsContainer = document.getElementById('archive-posts');
    var offset = 0;
    var limit = 31;
    var jsonData;

    loadMorePosts();

    function loadMorePosts() {
        var apiUrl = '/feed-community.json';

        fetch(apiUrl)
            .then(response => response.text())
            .then(data => {
                console.log('Raw JSON data:', data);
                jsonData = JSON.parse(data);
                updateBlogArchive();
            })
            .catch(error => {
                console.error('Error fetching posts:', error);
            });
    }

    function renderResult(post) {
        function getIcon(media) {
            if (media === "instagram") return '<i class="bi bi-instagram"></i>';
            if (media === "journal") return '<i class="bi bi-journal"></i>';
            if (media === "photo") return '<i class="bi bi-image"></i>';
            if (media === "video") return '<i class="bi bi-camera-reels"></i>';
            return ''; 
        }

        var iconHtml = getIcon(post.media);

        return `<div class="archive-link">
                    <a href="${post.url}">${iconHtml}  ${post.title}</a>
                </div>`;
    }

    function updateBlogArchive() {
        if (archiveYearSelect && archiveMonthSelect) {
            
            archiveYearSelect.innerHTML = '';
            archiveMonthSelect.innerHTML = '';

            
            var years = [...new Set(jsonData.map(post => new Date(post.date).getFullYear()))];
            var months = [...new Set(jsonData.map(post => new Date(post.date).toLocaleString('default', { month: 'long' })))];

            
            years.forEach(year => {
                var option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                archiveYearSelect.appendChild(option);
            });

            
            months.forEach(month => {
                var option = document.createElement('option');
                option.value = month;
                option.textContent = month;
                archiveMonthSelect.appendChild(option);
            });

            
            archiveYearSelect.addEventListener('change', updatePostsByYearMonth);
            archiveMonthSelect.addEventListener('change', updatePostsByYearMonth);

            
            var currentYear = new Date().getFullYear();
            archiveYearSelect.value = Math.max(...years, currentYear).toString();
            archiveMonthSelect.value = new Date().toLocaleString('default', { month: 'long' });

            
            updatePostsByYearMonth();
        }
    }

    function updatePostsByYearMonth() {
        var selectedYear = archiveYearSelect.value;
        var selectedMonth = archiveMonthSelect.value;

        var filteredPosts = jsonData.filter(post => {
            var postYear = new Date(post.date).getFullYear();
            var postMonth = new Date(post.date).toLocaleString('default', { month: 'long' });

            return (selectedYear === 'All' || postYear.toString() === selectedYear) &&
                   (selectedMonth === 'All' || postMonth === selectedMonth);
        });

        var results = filteredPosts.slice(offset, offset + limit).map(post => renderResult(post)).join('');
        archivePostsContainer.innerHTML = results;
    }
});

</script>


<hr>

<script>
document.addEventListener('DOMContentLoaded', function () {
  var sidebarBlog = document.getElementById('sidebar-blog2');
  var totalBlogPosts = document.createElement('p');

  totalBlogPosts.textContent = 'Total Articles: ' + {{ site.blogs | size }};
  sidebarBlog.appendChild(totalBlogPosts);
});
</script>




<!-- Bluesky RSS Sidebar Widget -->
<div id="bsky-widget" style="border: 1px solid #ccc; border-radius: 10px; padding: 1em; font-family: sans-serif;">
  <h3 style="margin-top: 0;"><a href="https://bsky.app/profile/midnightbardtarot.bsky.social" rel="me"><i class="bi bi-bluesky"></i> Bluesky</a></h3><hr/>
  <ul id="bsky-feed" style="list-style: none; padding-left: 0;"></ul>
</div>

<script>
(async function() {
  const feedUrl = 'https://rsshub.app/bsky/profile/midnightbardtarot.bsky.social';
  try {
    const response = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feedUrl)}`);
    const data = await response.json();
    const list = document.getElementById('bsky-feed');

    data.items.slice(0, 5).forEach(item => {
      const li = document.createElement('li');
      li.style.marginBottom = '1.5em';
      li.style.borderBottom = '1px solid #eee';
      li.style.paddingBottom = '1em';

      // Description
      const content = document.createElement('div');
      content.innerHTML = item.description;
      content.querySelectorAll('img').forEach(img => {
        img.style.maxWidth = '100%';
        img.style.borderRadius = '8px';
        img.style.marginTop = '0.5em';
      });

      // Link as timestamp
      const dateLink = document.createElement('a');
      dateLink.href = item.link;
      dateLink.target = "_blank";
      dateLink.style.display = 'block';
      dateLink.style.fontSize = '0.8em';
      dateLink.style.marginTop = '0.6em';
      dateLink.style.color = '#666';
      dateLink.style.textDecoration = 'none';
      const date = new Date(item.pubDate);
      dateLink.textContent = `ðŸ“… ${date.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' })}`;

      li.appendChild(content);
      li.appendChild(dateLink);
      list.appendChild(li);
    });

  } catch (e) {
    console.error('Failed to load feed', e);
    const errorMsg = document.createElement('p');
    errorMsg.textContent = "Couldn't load feed right now.";
    document.getElementById('bsky-feed').appendChild(errorMsg);
  }
})();
</script>



